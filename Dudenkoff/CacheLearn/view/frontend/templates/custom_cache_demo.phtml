<?php
/**
 * @var \Dudenkoff\CacheLearn\Block\CustomCacheDemo $block
 */
$exampleData = $block->getExampleData();
?>
<style>
.custom-cache-container { border: 3px solid #2196f3; background: #e3f2fd; padding: 20px; margin: 20px 0; border-radius: 8px; }
.custom-cache-container h2 { margin-top: 0; color: #1565c0; }
.data-display { background: #fff; padding: 20px; border-radius: 4px; border-left: 4px solid #2196f3; }
.data-row { padding: 10px; margin: 5px 0; background: #f5f5f5; border-radius: 4px; }
</style>

<div class="cache-demo">
    <div class="custom-cache-container">
        <h2>üîµ CUSTOM CACHE DEMO</h2>
        
        <div class="info-box">
            <p><strong>Cache Type:</strong></p>
            <ul>
                <li><code>Type: learn_cache</code></li>
                <li><code>Tag: LEARN_CACHE</code></li>
                <li><code>Lifetime: 300 seconds (5 minutes)</code></li>
                <li><code>Class: Dudenkoff\CacheLearn\Model\Cache\Type\LearnCache</code></li>
            </ul>
        </div>
        
        <div class="data-display">
            <h3>üì¶ Cached Data Example:</h3>
            <div class="data-row">
                <strong>Generated At:</strong> <?= $escaper->escapeHtml($exampleData['generated_at']) ?>
            </div>
            <div class="data-row">
                <strong>Random Number:</strong> <?= $escaper->escapeHtml($exampleData['random_number']) ?>
            </div>
            <div class="data-row">
                <strong>Message:</strong> <?= $escaper->escapeHtml($exampleData['message']) ?>
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>‚úÖ What's Happening:</strong></p>
            <ul>
                <li>This is <strong>custom cache</strong> - NOT block cache or FPC</li>
                <li>Only the <strong>DATA</strong> is cached (not HTML)</li>
                <li>Random number is generated once, then <strong>cached for 5 minutes</strong></li>
                <li>Refresh page - you'll see the <strong>same number</strong> for 5 minutes</li>
                <li>After 5 minutes, a <strong>new random number</strong> will be generated</li>
            </ul>
        </div>
        
        <div class="info-box">
            <p><strong>üìÅ Custom Cache Files:</strong></p>
            <div class="file-list">
<?php 
$files = $block->getCustomCacheFiles();
$cacheInfo = $block->getCacheInfo();
if (empty($files)): ?>
                Cache files will appear here after data is cached.
                Full path: <?= $escaper->escapeHtml($cacheInfo->getCacheDir()) ?>/mage--X/mage---69d_LEARN_CACHE_*
<?php else: 
    foreach ($files as $file): ?>
                <?= $escaper->escapeHtml($file) ?>
                Size: <?= $escaper->escapeHtml($cacheInfo->getFileSize($file)) ?>
                Modified: <?= $escaper->escapeHtml($cacheInfo->getFileModTime($file)) ?>
                
<?php 
    endforeach;
endif; ?>
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>üîß CLI Commands for Custom Cache:</strong></p>
            <div class="command-box">
# View cache status
bin/magento cache:status

# Enable custom cache type
bin/magento cache:enable learn_cache

# Clean custom cache type  
bin/magento cache:clean learn_cache

# Flush custom cache type
bin/magento cache:flush learn_cache

# Find custom cache files
find var/cache -name "*LEARN_CACHE*" -type f

# View cache file content
cat var/cache/mage--X/mage---69d_LEARN_CACHE_EXAMPLE
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>üìù How This Works in Code:</strong></p>
            <div class="command-box">
// Save to cache
$data = ['generated_at' => date('Y-m-d H:i:s'), 'random_number' => rand()];
$serialized = $this->serializer->serialize($data);
$this->cache->save($serialized, 'learn_cache_example', [], 300);

// Load from cache
$cached = $this->cache->load('learn_cache_example');
if ($cached) {
    $data = $this->serializer->unserialize($cached);
}

// Key becomes: mage---69d_LEARN_CACHE_EXAMPLE
            </div>
        </div>
        
        <div class="info-box">
            <p><strong>üìä Three Types of Cache Demonstrated:</strong></p>
            <ul>
                <li><strong>Full Page Cache (FPC):</strong> Entire HTML page - see var/page_cache/</li>
                <li><strong>Block Cache:</strong> Individual block HTML - see <a href="/cachelearn/blockcache">/cachelearn/blockcache</a></li>
                <li><strong>Custom Cache (This page):</strong> Your data - see var/cache/mage--*/LEARN_CACHE*</li>
            </ul>
        </div>
        
        <div class="info-box">
            <p><strong>üß™ Test It:</strong></p>
            <ol>
                <li>Note the "Random Number" above</li>
                <li>Refresh the page multiple times - <strong>number stays the same</strong></li>
                <li>Run: <code>bin/magento cache:clean learn_cache</code></li>
                <li>Refresh again - <strong>new random number!</strong></li>
            </ol>
        </div>
    </div>
</div>

